<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Demo UC01-UC02-UC03 - Qu·∫£n l√Ω l·ªãch chi·∫øu r·∫°p phim</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }
    header {
      padding: 12px 24px;
      background: #111827;
      color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 18px;
    }
    header .sub {
      font-size: 12px;
      opacity: 0.85;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 11px;
      background: #eef2ff;
      color: #e5e7eb;
      border: 1px solid rgba(156, 163, 175, 0.6);
    }
    main {
      padding: 0 24px 24px;
    }
    .tabs {
      display: flex;
      gap: 8px;
      border-bottom: 1px solid #e5e7eb;
      margin: 4px 0 10px;
    }
    .tab {
      padding: 8px 14px;
      font-size: 13px;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .tab span.icon {
      font-size: 14px;
    }
    .tab.active {
      background: #ffffff;
      border-bottom-color: #111827;
      color: #111827;
      font-weight: 600;
    }
    .tab:hover:not(.active) {
      background: #e5e7eb;
    }
    .tab-panels {
      margin-top: 0;
    }
    .panel {
      display: none;
      background: #ffffff;
      border-radius: 0 12px 12px 12px;
      box-shadow: 0 1px 6px rgba(15, 23, 42, 0.08);
      padding: 16px 18px 18px;
      margin-top: -1px;
    }
    .panel.active {
      display: block;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 1.1fr) minmax(0, 2fr);
      gap: 16px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    h2 {
      font-size: 16px;
      margin: 0 0 6px;
    }
    h3 {
      font-size: 14px;
      margin: 10px 0 4px;
    }
    .small {
      font-size: 12px;
      color: #6b7280;
    }

    .card-soft {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #f9fafb;
      font-size: 12px;
    }

    .field-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }
    .field-row label {
      min-width: 90px;
      font-size: 12px;
      color: #4b5563;
    }
    .field-row input,
    .field-row select {
      flex: 1;
      padding: 5px 6px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 12px;
      background: #ffffff;
    }
    .field-row input[type="time"] {
      max-width: 120px;
    }
    .field-row input[type="number"] {
      max-width: 80px;
    }
    .field-row small {
      font-size: 11px;
      color: #6b7280;
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      background: #e5e7eb;
      color: #374151;
    }
    .pill-draft { background: #e5e7eb; color:#374151; }
    .pill-pending { background: #fef3c7; color:#92400e; }
    .pill-approved { background: #dcfce7; color:#166534; }
    .pill-rejected { background: #fee2e2; color:#b91c1c; }

    .btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 6px 14px;
      font-size: 13px;
      background: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s ease;
    }
    .btn-primary {
      background: #111827;
      border-color: #111827;
      color: #f9fafb;
    }
    .btn-danger {
      border-color: #b91c1c;
      color: #b91c1c;
      background: #fff7f7;
    }
    .btn-ghost {
      background: transparent;
      border-color: transparent;
      padding: 4px 8px;
      font-size: 11px;
      color: #4b5563;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.25);
    }

    .stack-v {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 6px;
    }
    .table th,
    .table td {
      border-bottom: 1px solid #e5e7eb;
      padding: 6px 6px;
      text-align: left;
    }
    .table th {
      font-size: 11px;
      color: #6b7280;
      background: #f3f4f6;
    }
    .table tbody tr:hover {
      background: #f9fafb;
    }

    .tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: #eef2ff;
      color: #3730a3;
    }

    .occupancy-bar-bg {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    .occupancy-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,#facc15);
    }

    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }
    .filters-row > div {
      flex: 1;
      min-width: 130px;
    }
    .filters-row label {
      display: block;
      font-size: 11px;
      margin-bottom: 2px;
      color: #4b5563;
    }
    .filters-row input,
    .filters-row select {
      width: 100%;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 12px;
      background: #ffffff;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .summary-card {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #f9fafb;
      font-size: 12px;
    }
    .summary-card-title {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .summary-card-value {
      font-size: 14px;
      font-weight: 600;
    }

    .pending-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 420px;
      overflow-y: auto;
    }
    .pending-item {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-size: 12px;
      cursor: pointer;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .pending-item:hover {
      background: #eef2ff;
    }
    .pending-item.active {
      border-color: #111827;
      background: #e5e7ff;
    }
    .meta-line {
      font-size: 11px;
      color: #4b5563;
    }

    .split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 8px;
    }
    @media (max-width: 800px) {
      .split {
        grid-template-columns: 1fr;
      }
    }
    .subcard {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-size: 12px;
      background: #f9fafb;
    }
    .subcard-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .reason-box {
      margin-top: 8px;
      display: none;
      flex-direction: column;
      gap: 4px;
    }
    .reason-box textarea {
      width: 100%;
      min-height: 70px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 12px;
      resize: vertical;
    }

    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: #111827;
      color: #f9fafb;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 12px;
      box-shadow: 0 3px 12px rgba(15,23,42,0.45);
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: all 0.2s ease;
      z-index: 50;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .mt-8 { margin-top: 8px; }
    .mt-4 { margin-top: 4px; }
    
    .field-label {
      font-weight: 600;
      min-width: 120px;
      display: inline-block;
    }
    
    .field-value {
      color: #4b5563;
    }
  </style>
</head>
<body>
<header>
  <div>
    <h1>Module l·ªãch chi·∫øu ‚Äì Demo UC01 ‚Ä¢ UC02 ‚Ä¢ UC03</h1>
    <div class="sub">
      M√¥ ph·ªèng li·ªÅn m·∫°ch: Qu·∫£n l√Ω l·ªãch chi·∫øu (QL r·∫°p) ‚Ä¢ Tra c·ª©u & xem l·ªãch chi·∫øu (NV/QL) ‚Ä¢ Ph√™ duy·ªát su·∫•t chi·∫øu (QL c·ª•m).
    </div>
  </div>
  <span class="badge">DEMO ‚Äì Frontend Only</span>
</header>

<main>
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-target="panel-uc01">
      <span class="icon">üìÖ</span> UC01 ‚Äì Qu·∫£n l√Ω l·ªãch chi·∫øu
    </button>
    <button class="tab" data-target="panel-uc02">
      <span class="icon">üîç</span> UC02 ‚Äì Tra c·ª©u l·ªãch chi·∫øu
    </button>
    <button class="tab" data-target="panel-uc03">
      <span class="icon">‚úÖ</span> UC03 ‚Äì Ph√™ duy·ªát su·∫•t chi·∫øu
    </button>
  </div>

  <div class="tab-panels">
    <!-- PANEL UC01 -->
    <section id="panel-uc01" class="panel active">
      <div class="layout">
        <!-- Form l·∫≠p l·ªãch -->
        <div>
          <h2>UC01 ‚Äì Qu·∫£n l√Ω l·ªãch chi·∫øu (Qu·∫£n l√Ω r·∫°p)</h2>
          <div class="small">
            Demo thao t√°c t·∫°o m·ªõi su·∫•t chi·∫øu + c·∫•u h√¨nh l·ªãch l·∫∑p ‚Üí sinh ra nhi·ªÅu su·∫•t <strong>PENDING</strong> ƒë·ªÉ QL c·ª•m ph√™ duy·ªát.
          </div>

          <h3 class="mt-8">1. C·∫•u h√¨nh su·∫•t chi·∫øu c∆° b·∫£n</h3>
          <div class="card-soft stack-v">
            <div class="field-row">
              <label>R·∫°p</label>
              <select id="uc01-cinema">
                <option value="XYZ Time City">XYZ Time City</option>
                <option value="XYZ Vincom B√† Tri·ªáu">XYZ Vincom B√† Tri·ªáu</option>
                <option value="XYZ Royal City">XYZ Royal City</option>
              </select>
            </div>
            <div class="field-row">
              <label>Ph√≤ng chi·∫øu</label>
              <select id="uc01-room">
                <option value="Ph√≤ng 1">Ph√≤ng 1</option>
                <option value="Ph√≤ng 2">Ph√≤ng 2</option>
                <option value="Ph√≤ng 3">Ph√≤ng 3</option>
              </select>
            </div>
            <div class="field-row">
              <label>Phim</label>
              <select id="uc01-movie">
                <option value="DUNE: PH·∫¶N HAI">DUNE: PH·∫¶N HAI</option>
                <option value="MAI">MAI</option>
                <option value="CONAN: T√ÄU NG·∫¶M S·∫ÆT M√ÄU ƒêEN">CONAN: T√ÄU NG·∫¶M S·∫ÆT M√ÄU ƒêEN</option>
              </select>
            </div>
            <div class="field-row">
              <label>Ng√†y b·∫Øt ƒë·∫ßu</label>
              <input type="date" id="uc01-startdate" />
            </div>
            <div class="field-row">
              <label>Gi·ªù b·∫Øt ƒë·∫ßu</label>
              <input type="time" id="uc01-starttime" />
              <small>(v√≠ d·ª•: 20:00)</small>
            </div>
            <div class="field-row">
              <label>Th·ªùi l∆∞·ª£ng (ph√∫t)</label>
              <input type="number" id="uc01-duration" value="120" min="30" />
            </div>
            <div class="field-row">
              <label>ƒê·ªãnh d·∫°ng</label>
              <select id="uc01-format">
                <option value="2D">2D</option>
                <option value="3D">3D</option>
                <option value="IMAX">IMAX</option>
              </select>
            </div>
          </div>

          <h3 class="mt-8">2. L·ªãch l·∫∑p (t√πy ch·ªçn ‚Äì gi·ªëng Google Calendar)</h3>
          <div class="card-soft">
            <div class="field-row">
              <label style="min-width:140px;">Ki·ªÉu l·ªãch</label>
              <select id="uc01-repeat-type">
                <option value="single">L·ªãch ƒë∆°n (ch·ªâ 1 su·∫•t)</option>
                <option value="weekly">L·∫∑p theo tu·∫ßn</option>
              </select>
            </div>

            <div id="uc01-repeat-config" class="stack-v" style="margin-top:6px; display:none;">
              <div class="field-row">
                <label>Trong bao nhi√™u tu·∫ßn</label>
                <input type="number" id="uc01-weeks" value="4" min="1" />
              </div>
              <div class="field-row" style="align-items:flex-start;">
                <label>Ng√†y trong tu·∫ßn</label>
                <div style="display:flex; flex-wrap:wrap; gap:6px; font-size:11px;">
                  <label><input type="checkbox" class="uc01-dow" value="1" /> Th·ª© 2</label>
                  <label><input type="checkbox" class="uc01-dow" value="2" /> Th·ª© 3</label>
                  <label><input type="checkbox" class="uc01-dow" value="3" /> Th·ª© 4</label>
                  <label><input type="checkbox" class="uc01-dow" value="4" /> Th·ª© 5</label>
                  <label><input type="checkbox" class="uc01-dow" value="5" /> Th·ª© 6</label>
                  <label><input type="checkbox" class="uc01-dow" value="6" /> Th·ª© 7</label>
                  <label><input type="checkbox" class="uc01-dow" value="0" /> Ch·ªß nh·∫≠t</label>
                </div>
              </div>
              <div class="small">
                V√≠ d·ª•: ch·ªçn Th·ª© 2,3,4 v√† 4 tu·∫ßn ‚Üí h·ªá th·ªëng s·∫Ω sinh ra nhi·ªÅu su·∫•t t∆∞∆°ng ·ª©ng, t·∫•t c·∫£ ·ªü tr·∫°ng th√°i <strong>PENDING</strong> ƒë·ªÉ g·ª≠i QL c·ª•m ph√™ duy·ªát.
              </div>
            </div>
          </div>

          <h3 class="mt-8">3. H√†nh ƒë·ªông</h3>
          <div class="stack-v">
            <div class="small">
              ‚Ä¢ <strong>L∆∞u nh√°p</strong>: tr·∫°ng th√°i <span class="pill-status pill-draft">DRAFT</span> ‚Äì ch∆∞a g·ª≠i ph√™ duy·ªát. <br />
              ‚Ä¢ <strong>L∆∞u & g·ª≠i ph√™ duy·ªát</strong>: tr·∫°ng th√°i <span class="pill-status pill-pending">PENDING</span> ‚Äì s·∫Ω xu·∫•t hi·ªán b√™n UC03.
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" id="uc01-btn-draft">üíæ L∆∞u nh√°p</button>
              <button class="btn btn-primary" id="uc01-btn-pending">üì§ L∆∞u & g·ª≠i ph√™ duy·ªát</button>
            </div>
          </div>
        </div>

        <!-- B·∫£ng hi·ªÉn th·ªã c√°c su·∫•t ƒë√£ t·∫°o (ƒë·ªÉ th·∫•y ngay k·∫øt qu·∫£ UC01) -->
        <div>
          <div class="flex-between">
            <h3>Danh s√°ch su·∫•t chi·∫øu (demo d·ªØ li·ªáu d√πng chung cho UC01-02-03)</h3>
            <button class="btn-ghost" id="uc01-btn-refresh">‚Üª Refresh</button>
          </div>
          <div class="small">
            D·ªØ li·ªáu n√†y ƒë∆∞·ª£c chia s·∫ª cho: UC02 (tra c·ª©u) & UC03 (ph√™ duy·ªát). T·∫°o m·ªõi b√™n tr√°i xong, c√≥ th·ªÉ chuy·ªÉn tab ƒë·ªÉ xem.
          </div>
          <table class="table" id="uc01-table">
            <thead>
            <tr>
              <th>Phim</th>
              <th>R·∫°p / Ph√≤ng</th>
              <th>Ng√†y</th>
              <th>Gi·ªù</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PANEL UC02 -->
    <section id="panel-uc02" class="panel">
      <h2>UC02 ‚Äì Tra c·ª©u & xem l·ªãch chi·∫øu</h2>
      <div class="small">
        M√†n h√¨nh read-only gi√∫p NV r·∫°p / QL tra c·ª©u l·ªãch chi·∫øu theo ng√†y, r·∫°p, phim... v√† xem t√≥m t·∫Øt t√¨nh h√¨nh l·∫•p ƒë·∫ßy.
      </div>

      <div class="card-soft mt-8">
        <div class="filters-row">
          <div>
            <label>R·∫°p</label>
            <select id="uc02-filter-cinema">
              <option value="">T·∫•t c·∫£</option>
              <option value="XYZ Time City">XYZ Time City</option>
              <option value="XYZ Vincom B√† Tri·ªáu">XYZ Vincom B√† Tri·ªáu</option>
              <option value="XYZ Royal City">XYZ Royal City</option>
            </select>
          </div>
          <div>
            <label>Ng√†y</label>
            <input type="date" id="uc02-filter-date" />
          </div>
          <div>
            <label>ƒê·ªãnh d·∫°ng</label>
            <select id="uc02-filter-format">
              <option value="">T·∫•t c·∫£</option>
              <option value="2D">2D</option>
              <option value="3D">3D</option>
              <option value="IMAX">IMAX</option>
            </select>
          </div>
          <div>
            <label>T√™n phim</label>
            <input type="text" id="uc02-filter-movie" placeholder="Nh·∫≠p t√™n phim (Mai, Dune, Conan...)" />
          </div>
        </div>
        <div class="flex-between">
          <div class="small">Thay ƒë·ªïi b·ªô l·ªçc ‚Üí H·ªá th·ªëng √°p d·ª•ng v√† c·∫≠p nh·∫≠t ngay danh s√°ch su·∫•t chi·∫øu ph√≠a d∆∞·ªõi.</div>
          <button class="btn-ghost" id="uc02-btn-clear">X√≥a b·ªô l·ªçc</button>
        </div>
      </div>

      <div class="summary-cards" id="uc02-summary">
        <!-- T√≥m t·∫Øt: t·ªïng su·∫•t, t·ª∑ l·ªá l·∫•p ƒë·∫ßy TB, su·∫•t ƒë√¥ng kh√°ch nh·∫•t -->
      </div>

      <table class="table mt-4" id="uc02-table">
        <thead>
        <tr>
          <th>Gi·ªù</th>
          <th>Phim</th>
          <th>R·∫°p / Ph√≤ng</th>
          <th>ƒê·ªãnh d·∫°ng</th>
          <th>Gh·∫ø b√°n / t·ªïng</th>
          <th>L·∫•p ƒë·∫ßy</th>
          <th>Tr·∫°ng th√°i</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- PANEL UC03 -->
    <section id="panel-uc03" class="panel">
      <div class="layout">
        <!-- Danh s√°ch ch·ªù ph√™ duy·ªát -->
        <div>
          <h2>UC03 ‚Äì Ph√™ duy·ªát su·∫•t chi·∫øu (Qu·∫£n l√Ω c·ª•m r·∫°p)</h2>
          <div class="small">
            Danh s√°ch c√°c su·∫•t c√≥ tr·∫°ng th√°i <span class="pill-status pill-pending">PENDING</span> ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t b·ªüi Qu·∫£n l√Ω r·∫°p (t·ª´ UC01).
          </div>
          <div id="uc03-pending-list" class="pending-list"></div>
        </div>

        <!-- Chi ti·∫øt & ph√™ duy·ªát / t·ª´ ch·ªëi -->
        <div>
          <h3>Chi ti·∫øt ƒë·ªÅ xu·∫•t & so s√°nh</h3>
          <div id="uc03-detail-empty" class="small">
            Ch∆∞a ch·ªçn su·∫•t n√†o. Vui l√≤ng ch·ªçn m·ªôt d√≤ng ·ªü danh s√°ch b√™n tr√°i.
          </div>

          <div id="uc03-detail-area" style="display:none;">
            <div class="meta-line" id="uc03-detail-header"></div>

            <div class="split">
              <div class="subcard">
                <div class="subcard-title">L·ªãch hi·ªán t·∫°i (demo)</div>
                <div id="uc03-current-info" class="stack-v small">
                  <!-- V·ªõi demo n√†y, gi·∫£ ƒë·ªãnh l·ªãch hi·ªán t·∫°i √≠t su·∫•t h∆°n ‚Üí ch·ªß y·∫øu ƒë·ªÉ minh h·ªça so s√°nh -->
                  <div>(Gi·∫£ l·∫≠p l·ªãch hi·ªán t·∫°i c·ªßa ph√≤ng: h·ªá th·ªëng c√≥ th·ªÉ hi·ªÉn th·ªã c√°c su·∫•t xung quanh ƒë·ªÉ QL c·ª•m ƒë√°nh gi√°.)</div>
                </div>
              </div>
              <div class="subcard">
                <div class="subcard-title">L·ªãch ƒë·ªÅ xu·∫•t</div>
                <div id="uc03-proposed-info"></div>
              </div>
            </div>

            <div class="actions mt-8">
              <button class="btn btn-primary" id="uc03-btn-approve">‚úî Ph√™ duy·ªát</button>
              <button class="btn btn-danger" id="uc03-btn-reject">‚úñ T·ª´ ch·ªëi & ghi l√Ω do</button>
            </div>

            <div id="uc03-reason-box" class="reason-box">
              <label class="small">Nh·∫≠p l√Ω do t·ª´ ch·ªëi:</label>
              <textarea id="uc03-reason-input" placeholder="V√≠ d·ª•: Tr√πng khung gi·ªù v·ªõi su·∫•t hot, ƒë·ªÅ ngh·ªã chuy·ªÉn sang 21:30..."></textarea>
              <div class="actions">
                <button class="btn btn-danger" id="uc03-btn-submit-reject">G·ª≠i t·ª´ ch·ªëi</button>
                <button class="btn" id="uc03-btn-cancel-reject">H·ªßy</button>
              </div>
            </div>

            <div id="uc03-decision-info" class="small mt-4"></div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<div id="toast" class="toast"></div>

<script>
  // ======================================================
  // D·ªÆ LI·ªÜU DEMO CHUNG CHO C·∫¢ 3 USE CASE
  // ======================================================
  // status: DRAFT, PENDING, APPROVED, REJECTED
  // soldSeats & totalSeats: ƒë·ªÉ UC02 hi·ªÉn th·ªã occupancy.
  let showtimes = [
    {
      id: 1,
      cinema: "XYZ Time City",
      room: "Ph√≤ng 1",
      movie: "DUNE: PH·∫¶N HAI",
      date: "2025-12-22",
      startTime: "19:00",
      endTime: "21:30",
      format: "IMAX",
      status: "APPROVED",
      soldSeats: 100,
      totalSeats: 120,
      recurrenceId: null,
      createdBy: "QLR_TimeCity"
    },
    {
      id: 2,
      cinema: "XYZ Vincom B√† Tri·ªáu",
      room: "Ph√≤ng 2",
      movie: "MAI",
      date: "2025-12-22",
      startTime: "18:30",
      endTime: "20:30",
      format: "2D",
      status: "PENDING",
      soldSeats: 40,
      totalSeats: 120,
      recurrenceId: 1001,
      createdBy: "QLR_BaTrieu",
      rejectReason: ""
    },
    {
      id: 3,
      cinema: "XYZ Royal City",
      room: "Ph√≤ng 3",
      movie: "CONAN: T√ÄU NG·∫¶M S·∫ÆT M√ÄU ƒêEN",
      date: "2025-12-22",
      startTime: "21:15",
      endTime: "23:00",
      format: "2D",
      status: "PENDING",
      soldSeats: 80,
      totalSeats: 140,
      recurrenceId: 1002,
      createdBy: "QLR_Royal",
      rejectReason: ""
    }
  ];

  // id tƒÉng d·∫ßn
  let nextShowtimeId = showtimes.length + 1;
  let nextRecurrenceId = 2000;

  // ======================================================
  // TOAST
  // ======================================================
  const toastEl = document.getElementById("toast");
  function showToast(msg) {
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(() => toastEl.classList.remove("show"), 2000);
  }

  // ======================================================
  // TAB SWITCHING
  // ======================================================
  const tabs = document.querySelectorAll(".tab");
  const panels = document.querySelectorAll(".panel");
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      const targetId = tab.dataset.target;
      tabs.forEach(t => t.classList.remove("active"));
      panels.forEach(p => p.classList.remove("active"));
      tab.classList.add("active");
      document.getElementById(targetId).classList.add("active");
      // m·ªói khi ƒë·ªïi tab, render l·∫°i ƒë·ªÉ th·∫•y d·ªØ li·ªáu c·∫≠p nh·∫≠t
      renderUC01Table();
      renderUC02();
      renderUC03();
    });
  });

  // ======================================================
  // UC01 ‚Äì QU·∫¢N L√ù L·ªäCH CHI·∫æU
  // ======================================================
  const uc01Cinema = document.getElementById("uc01-cinema");
  const uc01Room = document.getElementById("uc01-room");
  const uc01Movie = document.getElementById("uc01-movie");
  const uc01StartDate = document.getElementById("uc01-startdate");
  const uc01StartTime = document.getElementById("uc01-starttime");
  const uc01Duration = document.getElementById("uc01-duration");
  const uc01Format = document.getElementById("uc01-format");
  const uc01RepeatType = document.getElementById("uc01-repeat-type");
  const uc01RepeatConfig = document.getElementById("uc01-repeat-config");
  const uc01Weeks = document.getElementById("uc01-weeks");
  const uc01BtnDraft = document.getElementById("uc01-btn-draft");
  const uc01BtnPending = document.getElementById("uc01-btn-pending");
  const uc01TableBody = document.querySelector("#uc01-table tbody");
  const uc01BtnRefresh = document.getElementById("uc01-btn-refresh");

  // set default date today
  const todayStr = new Date().toISOString().slice(0,10);
  uc01StartDate.value = todayStr;
  document.getElementById("uc02-filter-date").value = todayStr;

  uc01RepeatType.addEventListener("change", () => {
    uc01RepeatConfig.style.display = uc01RepeatType.value === "weekly" ? "block" : "none";
  });

  function addShowtimesFromForm(status) {
    const cinema = uc01Cinema.value;
    const room = uc01Room.value;
    const movie = uc01Movie.value;
    const dateStr = uc01StartDate.value;
    const startTime = uc01StartTime.value;
    const duration = parseInt(uc01Duration.value || "0", 10);
    const format = uc01Format.value;

    if (!cinema || !room || !movie || !dateStr || !startTime || duration <= 0) {
      showToast("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin c∆° b·∫£n (r·∫°p, ph√≤ng, phim, ng√†y, gi·ªù, th·ªùi l∆∞·ª£ng).");
      return;
    }

    // t√≠nh gi·ªù k·∫øt th√∫c (ƒë∆°n gi·∫£n: c·ªông ph√∫t v√†o gi·ªù)
    function calcEndTime(start, durationMin) {
      const [h, m] = start.split(":").map(Number);
      const total = h*60 + m + durationMin;
      const hh = String(Math.floor(total / 60) % 24).padStart(2,"0");
      const mm = String(total % 60).padStart(2,"0");
      return hh + ":" + mm;
    }
    const baseEndTime = calcEndTime(startTime, duration);

    const repeatType = uc01RepeatType.value;
    let generated = 0;

    if (repeatType === "single") {
      showtimes.push({
        id: nextShowtimeId++,
        cinema,
        room,
        movie,
        date: dateStr,
        startTime,
        endTime: baseEndTime,
        format,
        status,
        soldSeats: 0,
        totalSeats: 120,
        recurrenceId: null,
        createdBy: "QLR_DEMO",
        rejectReason: ""
      });
      generated = 1;
    } else {
      // weekly pattern
      const weeks = parseInt(uc01Weeks.value || "1", 10);
      const dowCheckboxes = document.querySelectorAll(".uc01-dow:checked");
      if (dowCheckboxes.length === 0) {
        showToast("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ng√†y trong tu·∫ßn cho l·ªãch l·∫∑p.");
        return;
      }
      const selectedDow = Array.from(dowCheckboxes).map(cb => parseInt(cb.value,10));
      const recurrenceId = nextRecurrenceId++;

      const startDateObj = new Date(dateStr);
      if (isNaN(startDateObj.getTime())) {
        showToast("Ng√†y b·∫Øt ƒë·∫ßu kh√¥ng h·ª£p l·ªá.");
        return;
      }

      // sinh trong N tu·∫ßn
      for (let w = 0; w < weeks; w++) {
        selectedDow.forEach(dow => {
          const d = new Date(startDateObj);
          // ƒë∆∞a v·ªÅ tu·∫ßn w
          d.setDate(d.getDate() + w*7);
          // ch·ªânh ƒë·∫øn ƒë√∫ng dow
          const currentDow = d.getDay(); // 0 CN, 1-6 Th·ª©
          let diff = dow - currentDow;
          d.setDate(d.getDate() + diff);
          const dateGenerated = d.toISOString().slice(0,10);

          showtimes.push({
            id: nextShowtimeId++,
            cinema,
            room,
            movie,
            date: dateGenerated,
            startTime,
            endTime: baseEndTime,
            format,
            status,
            soldSeats: 0,
            totalSeats: 120,
            recurrenceId,
            createdBy: "QLR_DEMO",
            rejectReason: ""
          });
          generated++;
        });
      }
    }

    renderUC01Table();
    renderUC02();
    renderUC03();
    if (generated > 0) {
      const msg = repeatType === "single"
        ? `ƒê√£ t·∫°o 1 su·∫•t chi·∫øu ·ªü tr·∫°ng th√°i ${status}.`
        : `ƒê√£ t·∫°o ${generated} su·∫•t chi·∫øu theo l·ªãch l·∫∑p (${status}).`;
      showToast(msg);
    }
  }

  uc01BtnDraft.addEventListener("click", () => addShowtimesFromForm("DRAFT"));
  uc01BtnPending.addEventListener("click", () => addShowtimesFromForm("PENDING"));
  uc01BtnRefresh.addEventListener("click", () => renderUC01Table());

  function renderUC01Table() {
    uc01TableBody.innerHTML = "";
    // s·∫Øp theo ng√†y + gi·ªù
    const sorted = [...showtimes].sort((a,b) => {
      if (a.date === b.date) {
        return a.startTime.localeCompare(b.startTime);
      }
      return a.date.localeCompare(b.date);
    });
    sorted.forEach(st => {
      const tr = document.createElement("tr");
      const statusLabel = getStatusPill(st.status);
      tr.innerHTML = `
        <td>${st.movie}</td>
        <td>${st.cinema} / ${st.room}</td>
        <td>${st.date}</td>
        <td>${st.startTime} - ${st.endTime}</td>
        <td>${statusLabel}</td>
      `;
      uc01TableBody.appendChild(tr);
    });
  }

  function getStatusPill(status) {
    if (status === "APPROVED") return `<span class="pill-status pill-approved">APPROVED</span>`;
    if (status === "PENDING") return `<span class="pill-status pill-pending">PENDING</span>`;
    if (status === "REJECTED") return `<span class="pill-status pill-rejected">REJECTED</span>`;
    return `<span class="pill-status pill-draft">DRAFT</span>`;
  }

  // ======================================================
  // UC02 ‚Äì TRA C·ª®U & XEM L·ªäCH CHI·∫æU
  // ======================================================
  const uc02Cinema = document.getElementById("uc02-filter-cinema");
  const uc02Date = document.getElementById("uc02-filter-date");
  const uc02Format = document.getElementById("uc02-filter-format");
  const uc02Movie = document.getElementById("uc02-filter-movie");
  const uc02TableBody = document.querySelector("#uc02-table tbody");
  const uc02Summary = document.getElementById("uc02-summary");
  const uc02BtnClear = document.getElementById("uc02-btn-clear");

  uc02Cinema.addEventListener("change", renderUC02);
  uc02Date.addEventListener("change", renderUC02);
  uc02Format.addEventListener("change", renderUC02);
  uc02Movie.addEventListener("input", renderUC02);
  uc02BtnClear.addEventListener("click", () => {
    uc02Cinema.value = "";
    uc02Format.value = "";
    uc02Movie.value = "";
    uc02Date.value = todayStr;
    renderUC02();
  });

  function renderUC02() {
    const cinema = uc02Cinema.value;
    const date = uc02Date.value;
    const format = uc02Format.value;
    const movieKeyword = uc02Movie.value.trim().toLowerCase();

    let filtered = showtimes.filter(st => {
      if (cinema && st.cinema !== cinema) return false;
      if (date && st.date !== date) return false;
      if (format && st.format !== format) return false;
      if (movieKeyword && !st.movie.toLowerCase().includes(movieKeyword)) return false;
      return true;
    });

    uc02TableBody.innerHTML = "";
    if (filtered.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="7" class="small">Kh√¥ng t√¨m th·∫•y su·∫•t chi·∫øu n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.</td>`;
      uc02TableBody.appendChild(tr);
    } else {
      // sort theo gi·ªù
      filtered.sort((a,b) => a.startTime.localeCompare(b.startTime));
      filtered.forEach(st => {
        const occupancy = st.totalSeats > 0 ? (st.soldSeats / st.totalSeats) * 100 : 0;
        let level = "V·∫Øng";
        if (occupancy >= 80) level = "R·∫•t ƒë√¥ng";
        else if (occupancy >= 50) level = "Kh√° ƒë√¥ng";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${st.startTime}</td>
          <td>${st.movie}</td>
          <td>${st.cinema} / ${st.room}</td>
          <td>${st.format}</td>
          <td>${st.soldSeats} / ${st.totalSeats}</td>
          <td>
            <div class="occupancy-bar-bg">
              <div class="occupancy-bar-fill" style="width:${occupancy.toFixed(0)}%;"></div>
            </div>
            <div class="small">${occupancy.toFixed(0)}% ‚Äì ${level}</div>
          </td>
          <td>${getStatusPill(st.status)}</td>
        `;
        uc02TableBody.appendChild(tr);
      });
    }

    // summary
    renderUC02Summary(filtered);
  }

  function renderUC02Summary(list) {
    uc02Summary.innerHTML = "";
    const total = list.length;
    if (total === 0) {
      uc02Summary.innerHTML = `<div class="summary-card"><div class="summary-card-title">T·ªïng su·∫•t trong ng√†y</div><div class="summary-card-value">0</div></div>`;
      return;
    }
    let sumOccupancy = 0;
    let best = list[0];
    list.forEach(st => {
      const occ = st.totalSeats > 0 ? st.soldSeats / st.totalSeats : 0;
      sumOccupancy += occ;
      if (occ > (best.totalSeats ? best.soldSeats / best.totalSeats : 0)) best = st;
    });
    const avgOcc = (sumOccupancy / total) * 100;
    const bestOcc = best.totalSeats > 0 ? (best.soldSeats / best.totalSeats) * 100 : 0;

    const card1 = document.createElement("div");
    card1.className = "summary-card";
    card1.innerHTML = `
      <div class="summary-card-title">T·ªïng s·ªë su·∫•t chi·∫øu (kh·ªõp b·ªô l·ªçc)</div>
      <div class="summary-card-value">${total}</div>
    `;
    const card2 = document.createElement("div");
    card2.className = "summary-card";
    card2.innerHTML = `
      <div class="summary-card-title">T·ª∑ l·ªá l·∫•p ƒë·∫ßy trung b√¨nh</div>
      <div class="summary-card-value">${avgOcc.toFixed(0)}%</div>
    `;
    const card3 = document.createElement("div");
    card3.className = "summary-card";
    card3.innerHTML = `
      <div class="summary-card-title">Su·∫•t ƒë√¥ng kh√°ch nh·∫•t</div>
      <div class="summary-card-value">${best.movie}</div>
      <div class="small">${best.cinema} / ${best.room} ‚Ä¢ ${best.date} ‚Ä¢ ${best.startTime} (${bestOcc.toFixed(0)}%)</div>
    `;
    uc02Summary.append(card1, card2, card3);
  }

  // ======================================================
  // UC03 ‚Äì PH√ä DUY·ªÜT SU·∫§T CHI·∫æU
  // ======================================================
  const uc03List = document.getElementById("uc03-pending-list");
  const uc03DetailEmpty = document.getElementById("uc03-detail-empty");
  const uc03DetailArea = document.getElementById("uc03-detail-area");
  const uc03DetailHeader = document.getElementById("uc03-detail-header");
  const uc03CurrentInfo = document.getElementById("uc03-current-info");
  const uc03ProposedInfo = document.getElementById("uc03-proposed-info");
  const uc03BtnApprove = document.getElementById("uc03-btn-approve");
  const uc03BtnReject = document.getElementById("uc03-btn-reject");
  const uc03ReasonBox = document.getElementById("uc03-reason-box");
  const uc03ReasonInput = document.getElementById("uc03-reason-input");
  const uc03BtnSubmitReject = document.getElementById("uc03-btn-submit-reject");
  const uc03BtnCancelReject = document.getElementById("uc03-btn-cancel-reject");
  const uc03DecisionInfo = document.getElementById("uc03-decision-info");

  let uc03SelectedId = null;

  function renderUC03() {
    const pendingList = showtimes.filter(st => st.status === "PENDING");
    uc03List.innerHTML = "";
    uc03SelectedId = null;
    uc03DetailArea.style.display = "none";
    uc03DetailEmpty.style.display = pendingList.length ? "block" : "block";
    uc03DetailEmpty.textContent = pendingList.length
      ? "Ch∆∞a ch·ªçn su·∫•t n√†o. Vui l√≤ng ch·ªçn m·ªôt d√≤ng ·ªü danh s√°ch b√™n tr√°i."
      : "Hi·ªán kh√¥ng c√≥ su·∫•t n√†o ·ªü tr·∫°ng th√°i PENDING.";

    pendingList
      .sort((a,b) => a.date === b.date ? a.startTime.localeCompare(b.startTime) : a.date.localeCompare(b.date))
      .forEach(st => {
        const div = document.createElement("div");
        div.className = "pending-item";
        div.dataset.id = st.id;
        div.innerHTML = `
          <div><strong>${st.movie}</strong> - ${st.cinema}</div>
          <div class="meta-line">${st.date} ‚Ä¢ ${st.startTime} ‚Ä¢ ${st.room}</div>
          <div class="meta-line">Tr·∫°ng th√°i: <span class="pill-status pill-pending">PENDING</span></div>
        `;
        div.addEventListener("click", () => {
          uc03SelectedId = st.id;
          document.querySelectorAll(".pending-item").forEach(e => e.classList.remove("active"));
          div.classList.add("active");
          renderUC03Detail();
        });
        uc03List.appendChild(div);
      });
  }

  function renderUC03Detail() {
    const st = showtimes.find(x => x.id === uc03SelectedId);
    if (!st) {
      uc03DetailArea.style.display = "none";
      uc03DetailEmpty.style.display = "block";
      return;
    }
    uc03DetailArea.style.display = "block";
    uc03DetailEmpty.style.display = "none";
    uc03ReasonBox.style.display = "none";
    uc03ReasonInput.value = "";
    uc03DecisionInfo.textContent = "";

    uc03DetailHeader.textContent = `R·∫°p: ${st.cinema} ‚Ä¢ ${st.room} ‚Ä¢ Ng√†y: ${st.date}`;

    // Demo "l·ªãch hi·ªán t·∫°i" ‚Äì ·ªü ƒë√¢y ch·ªâ hi·ªÉn th·ªã text g·ª£i √Ω, b·∫°n c√≥ th·ªÉ n·ªëi v·ªõi DB su·∫•t hi·ªán c√≥ trong ph√≤ng ƒë√≥
    uc03CurrentInfo.innerHTML = `
      <div>‚Ä¢ Gi·∫£ l·∫≠p: ph√≤ng n√†y hi·ªán ƒëang c√≥ c√°c su·∫•t kh√°c xung quanh gi·ªù ${st.startTime}.</div>
      <div class="small">Trong h·ªá th·ªëng th·ª±c, ph·∫ßn n√†y s·∫Ω hi·ªÉn th·ªã c√°c su·∫•t ƒë√£ APPROVED ƒë·ªÉ QL c·ª•m so s√°nh xung ƒë·ªôt.</div>
    `;

    uc03ProposedInfo.innerHTML = `
      <div class="field-row">
        <span class="field-label">Phim:</span>
        <span class="field-value">${st.movie}</span>
      </div>
      <div class="field-row">
        <span class="field-label">Gi·ªù ƒë·ªÅ xu·∫•t:</span>
        <span class="field-value">${st.startTime} - ${st.endTime}</span>
      </div>
      <div class="field-row">
        <span class="field-label">ƒê·ªãnh d·∫°ng:</span>
        <span class="field-value">${st.format}</span>
      </div>
      <div class="field-row">
        <span class="field-label">Ng∆∞·ªùi ƒë·ªÅ xu·∫•t:</span>
        <span class="field-value">${st.createdBy || "QLR_DEMO"}</span>
      </div>
    `;

    const disabled = st.status !== "PENDING";
    uc03BtnApprove.disabled = disabled;
    uc03BtnReject.disabled = disabled;

    if (st.status === "APPROVED") {
      uc03DecisionInfo.textContent = "L·ªãch n√†y ƒë√£ ƒë∆∞·ª£c ph√™ duy·ªát.";
    } else if (st.status === "REJECTED") {
      uc03DecisionInfo.textContent = "L·ªãch n√†y ƒë√£ b·ªã t·ª´ ch·ªëi. L√Ω do: " + (st.rejectReason || "(kh√¥ng c√≥).");
    }
  }

  uc03BtnApprove.addEventListener("click", () => {
    const st = showtimes.find(x => x.id === uc03SelectedId);
    if (!st || st.status !== "PENDING") return;
    st.status = "APPROVED";
    st.rejectReason = "";
    showToast("ƒê√£ ph√™ duy·ªát su·∫•t chi·∫øu.");
    renderUC01Table();
    renderUC02();
    renderUC03();
  });

  uc03BtnReject.addEventListener("click", () => {
    const st = showtimes.find(x => x.id === uc03SelectedId);
    if (!st || st.status !== "PENDING") return;
    uc03ReasonBox.style.display = "flex";
    uc03ReasonInput.focus();
  });

  uc03BtnCancelReject.addEventListener("click", () => {
    uc03ReasonBox.style.display = "none";
    uc03ReasonInput.value = "";
  });

  uc03BtnSubmitReject.addEventListener("click", () => {
    const st = showtimes.find(x => x.id === uc03SelectedId);
    if (!st || st.status !== "PENDING") return;
    const reason = uc03ReasonInput.value.trim();
    if (!reason) {
      showToast("Vui l√≤ng nh·∫≠p l√Ω do t·ª´ ch·ªëi.");
      return;
    }
    st.status = "REJECTED";
    st.rejectReason = reason;
    showToast("ƒê√£ t·ª´ ch·ªëi su·∫•t chi·∫øu & l∆∞u l√Ω do.");
    uc03ReasonBox.style.display = "none";
    renderUC01Table();
    renderUC02();
    renderUC03();
  });

  // ======================================================
  // INIT
  // ======================================================
  renderUC01Table();
  renderUC02();
  renderUC03();
</script>

</body>
</html>
